<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hishab Khata</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body class="bg-slate-100 p-4">

<!-- AUTH SCREEN -->
<div id="authBox" class="max-w-sm mx-auto bg-white p-8 rounded-2xl shadow">
  <h2 class="text-xl font-bold mb-4 text-center">Login / Register</h2>
  <input id="email" type="email" class="w-full p-3 border rounded mb-3" placeholder="example@gmail.com" required>
  <input id="password" type="password" class="w-full p-3 border rounded mb-4" placeholder="Password" required>

  <button onclick="login()" class="w-full bg-blue-600 text-white py-3 rounded mb-2">Login</button>
  <button onclick="register()" class="w-full bg-slate-800 text-white py-3 rounded">Register</button>
</div>

<!-- APP -->
<div id="app" class="hidden max-w-4xl mx-auto">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold">ðŸ“Š Hishab Khata</h1>
    <button onclick="logout()" class="text-red-600 font-bold">Logout</button>
  </div>

  <div class="grid grid-cols-3 gap-3 mb-4">
    <div class="bg-white p-4 rounded">Income<br><b id="income">à§³0</b></div>
    <div class="bg-white p-4 rounded">Expense<br><b id="expense">à§³0</b></div>
    <div class="bg-white p-4 rounded">Balance<br><b id="balance">à§³0</b></div>
  </div>

  <div class="bg-white p-4 rounded mb-4">
    <input id="title" placeholder="Details" class="border p-2 w-full mb-2">
    <input id="amount" type="number" placeholder="Amount" class="border p-2 w-full mb-2">
    <select id="type" class="border p-2 w-full mb-2">
      <option value="income">Income</option>
      <option value="expense">Expense</option>
    </select>
    <button onclick="addEntry()" class="bg-blue-600 text-white w-full py-2 rounded">Save</button>
  </div>

  <div class="bg-white p-4 rounded">
    <canvas id="chart" height="120"></canvas>
  </div>
</div>

<script>
/* ðŸ”¥ FIREBASE CONFIG - Replace with your own */
firebase.initializeApp({
  apiKey: "AIzaSyBNbT6hYnRd5HYp-trhVJLUui4HsZuu_Lo",
            authDomain: "myhishab-12637.firebaseapp.com",
            databaseURL: "https://myhishab-12637-default-rtdb.firebaseio.com",
            projectId: "myhishab-12637"
  
});

let uid, dbRef, chart;
const emailEl = document.getElementById("email");
const passwordEl = document.getElementById("password");
const incomeEl = document.getElementById("income");
const expenseEl = document.getElementById("expense");
const balanceEl = document.getElementById("balance");
const chartEl = document.getElementById("chart");

/* AUTH STATE */
firebase.auth().onAuthStateChanged(user => {
  if(user){
    uid = user.uid;
    dbRef = firebase.database().ref("users/" + uid);
    document.getElementById("authBox").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    loadData();
  } else {
    document.getElementById("authBox").classList.remove("hidden");
    document.getElementById("app").classList.add("hidden");
  }
});

/* REGISTER */
function register(){
  const email = emailEl.value.trim();
  const pass = passwordEl.value.trim();
  if(!email || !pass){ alert("Email à¦“ Password à¦²à¦¿à¦–à§à¦¨"); return; }

  firebase.auth().createUserWithEmailAndPassword(email, pass)
    .then(()=> alert("Register Successful"))
    .catch(err=> alert(err.message));
}

/* LOGIN */
function login(){
  const email = emailEl.value.trim();
  const pass = passwordEl.value.trim();
  if(!email || !pass){ alert("Email à¦“ Password à¦²à¦¿à¦–à§à¦¨"); return; }

  firebase.auth().signInWithEmailAndPassword(email, pass)
    .catch(err=> alert(err.message));
}

/* LOGOUT */
function logout(){ firebase.auth().signOut(); }

/* ADD ENTRY */
function addEntry(){
  const title = document.getElementById("title").value.trim();
  const amount = Number(document.getElementById("amount").value);
  const type = document.getElementById("type").value;

  if(!title || !amount) return alert("Title & Amount à¦²à¦¾à¦—à¦¬à§‡");

  dbRef.push({title, amount, type, date: Date.now()});
  document.getElementById("title").value = "";
  document.getElementById("amount").value = "";
}

/* LOAD DATA */
function loadData(){
  dbRef.on("value", snap => {
    let income=0, expense=0, data=[];
    snap.forEach(s => { const d=s.val(); data.push(d); d.type==="income"?income+=d.amount:expense+=d.amount; });
    incomeEl.innerText = "à§³"+income;
    expenseEl.innerText = "à§³"+expense;
    balanceEl.innerText = "à§³"+(income-expense);
    drawChart(data);
  });
}

/* DRAW CHART */
function drawChart(data){
  if(chart) chart.destroy();
  chart = new Chart(chartEl, {
    type: "pie",
    data: {
      labels: ["Income","Expense"],
      datasets:[{data:[
        data.filter(d=>d.type==="income").reduce((s,e)=>s+e.amount,0),
        data.filter(d=>d.type==="expense").reduce((s,e)=>s+e.amount,0)
      ], backgroundColor: ["#10b981","#ef4444"]}]
    }
  });
}

/* PWA */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>


